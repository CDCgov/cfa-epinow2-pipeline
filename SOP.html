<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NA • CFAEpiNow2Pipeline</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="NA"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">CFAEpiNow2Pipeline</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NA</h1>

    </div>

<div class="section level2">
<h2 id="epinow2-rt-pipeline-local-run">Epinow2 Rt Pipeline Local Run<a class="anchor" aria-label="anchor" href="#epinow2-rt-pipeline-local-run"></a></h2>
<p>This document is meant to guide someone in running the weekly Rt estimation pipeline from within the VAP (Virtual Analytic Platform). The main command for running the weekly pipeline (found in the Makefile) is <code>make run-prod</code>. Running this will create and utilize a suite of configuration files (.json) specified from within the associated blob storage account and will produce outputs in the <code>rt-epinow2-output</code> Azure blob storage account.</p>
<div class="section level3">
<h3 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a></h3>
<ol style="list-style-type: decimal"><li>VAP environment &amp; Account
<ul><li>git (<code>sudo apt-get install git</code>)</li>
<li>docker CLI</li>
<li>gh CLI (<code>sudo apt-get install gh</code>)</li>
</ul></li>
<li>cfa-epinow2-pipeline repository in VAP
<ul><li>Navigate to where you would like to clone the repository code</li>
<li>Clone the repository (<code>git clone https://www.github.com/cdcgov/cfa-epinow2-pipeline</code> OR <code>gh auth login</code> and then <code>gh repo clone cdcgov/cfa-epinow2-pipeline</code>)</li>
</ul></li>
<li>Authentication to Azure To authenticate to the requisite Azure resources provide a <code>.env</code> file containing the secrets necessary for authentication.
<ul><li>Request access to necessary Azure credential file (.env) from any of the admins listed in the README.md</li>
<li>decrypt the file (<code>gpg --decrypt .env</code>)</li>
<li>Place the decrypted file in your <code>cfa-epinow2-pipeline</code> directory</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="test-pre-requisites-are-setup">Test Pre-requisites are Setup<a class="anchor" aria-label="anchor" href="#test-pre-requisites-are-setup"></a></h3>
<div class="section level4">
<h4 id="test-configuration-generation">Test Configuration Generation<a class="anchor" aria-label="anchor" href="#test-configuration-generation"></a></h4>
<ol style="list-style-type: decimal"><li>
<code>make config</code> Running this command runs code located in the CDCgov/cfa-config-generator repository. This command creates a suite of configuration file and saves it into the appropriate azure blob storage account. If you receive an error that you do not have the necessary permissions to run this command please reach out Agastya Mondal (<a href="mailto:ab59@cdc.gov" class="email">ab59@cdc.gov</a>) for assistance.</li>
</ol></div>
<div class="section level4">
<h4 id="test-make-run-command">Test make run command<a class="anchor" aria-label="anchor" href="#test-make-run-command"></a></h4>
<ol style="list-style-type: decimal"><li>The following command will test your setup for using the <code>CFAEpiNow2Pipeline</code> package. This command will run the pipeline for a single state and disease locally (using the computing power of your VAP account). This will take approximately 2 minutes. <code>make run CONFIG=test/test.json</code>
</li>
<li>The following command will test your connection to Azure Batch resources. This command will run the pipeline for a single state (NY) and run using Azure Batch resources. To track the status of the nodes and pool, open Azure Batch Explorer. <code>make test-batch</code>
</li>
</ol></div>
</div>
<div class="section level3">
<h3 id="rt-estimation-pipeline-production">Rt Estimation Pipeline (Production)<a class="anchor" aria-label="anchor" href="#rt-estimation-pipeline-production"></a></h3>
<p>If you have succesfully setup the pre-requisites and are able to run <code>make config</code> and <code>make run CONGIF=test/test.json</code> you are ready to run the entire pipeline in production <code>make run-prod</code>. This command will run <code>make config</code>, then followed by a docker build, and then will the <code>job.py</code> script from in Batch; you only need to run <code>make run-prod</code> all of the work is done for you inside the Makefile! In doing so you are connecting to Azure Batch and setup 102 unique tasks that Azure Batch will run. This command is intended to close after initializing the jobs in Azure Batch. Please open Azure Batch Explorer to view the progress of these tasks.</p>
<div class="section level4">
<h4 id="exclusions">Exclusions<a class="anchor" aria-label="anchor" href="#exclusions"></a></h4>
<p>If you would like to re-run the entire pipeline with exclusions to the configurations you are able to do so. There are two main types of exclusions that users commonly will need to consider (task exclusions, and data exclusions). ##### Task Exclusions Task exclusions are state and disease pairs (ex. ‘NY:COVID-19)’ that users can specify when running so that tasks for specified state disease pairs are not generated unnecessarily. Users can specify more than one state and disease pair, so long as they are separate by a ‘,’ (ex. ‘NY:COVID-19,WA:Influenza’). To do so, a user will need to first, generate the configuration files and specify the state:disease pair to exclude (see example below) and second, run the pipeline for these configurations. 1. <code>TIMESTAMP=$(date -u +"%Y%m%d_%H%M%S"); JOB_ID=Rt-estimation-$(echo $TIMESTAMP)</code> 2. <code>gh workflow run -R cdcgov/cfa-config-generator run-workload.yaml -f job_id=$(echo $JOB_ID) -f task_exclusions='NY:COVID-19'</code> 3. <code>make run-batch JOB=$(echo $JOB_ID)</code></p>
<div class="section level5">
<h5 id="data-exclusions">Data Exclusions<a class="anchor" aria-label="anchor" href="#data-exclusions"></a></h5>
<p>The process for handling data exclusions is currently being finalized adn this section will be finalized in April 2025. For the current procedure please reach out to Patrick Corbett (<a href="mailto:pyv3@cdc.gov" class="email">pyv3@cdc.gov</a>).</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a></h3>
<div class="section level4">
<h4 id="podman">Podman<a class="anchor" aria-label="anchor" href="#podman"></a></h4>
<p>The default container management software is setup to utilize docker. For users that are currently using podman, please adjust the variable <code>CNTR_MGR</code> within the makefile prior to running any commands. Further, it will be necessary to authenticate to azure resources through podman (<code>podman login</code>).</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary Susswein.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

